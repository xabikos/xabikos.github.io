
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Web development with asp.net and React.js">
    <title>Create a multitenant application with Entity Framework Code First - Part 1 - Web development with asp.net and React.js</title>
    <meta name="author" content="Babis Karypidis">
    
        <meta name="keywords" content="entity framework,multitenant,code first">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta name="description" content="A highly increasing request we have to serve as developers, especially after Software as a Service revolution, is to provide software that is able to handle individual users in one application by sepa">
<meta property="og:type" content="blog">
<meta property="og:title" content="Create a multitenant application with Entity Framework Code First - Part 1">
<meta property="og:url" content="http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/index.html">
<meta property="og:site_name" content="Web development with asp.net and React.js">
<meta property="og:description" content="A highly increasing request we have to serve as developers, especially after Software as a Service revolution, is to provide software that is able to handle individual users in one application by sepa">
<meta property="og:updated_time" content="2016-04-26T17:20:57.394Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Create a multitenant application with Entity Framework Code First - Part 1">
<meta name="twitter:description" content="A highly increasing request we have to serve as developers, especially after Software as a Service revolution, is to provide software that is able to handle individual users in one application by sepa">
<meta name="twitter:creator" content="@xabikos">
    
    
        
    
    
        <meta property="og:image" content="http://www.gravatar.com/avatar/7c9ee05396641133c8d505197fc17cc5?s=640"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-quwccsthbllipo6252snb2tfkddvrsp1eczkytpz3vmxpsb6nwodixemlkux.min.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-56484404-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Web development with asp.net and React.js</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="/#about">
        
        
            <img class="header-picture" src="http://www.gravatar.com/avatar/7c9ee05396641133c8d505197fc17cc5?s=90"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->


    

<nav id="sidebar" data-behavior="4">
    
        <div class="sidebar-profile">
            <a href="/#about">
                    <img class="sidebar-profile-picture" src="http://www.gravatar.com/avatar/7c9ee05396641133c8d505197fc17cc5?s=110"/>
            </a>
            <span class="sidebar-profile-name">Babis Karypidis</span>
        </div>
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/xabikos" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://twitter.com/xabikos" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
                    <span class="sidebar-button-desc">Twitter</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://www.linkedin.com/in/charalamposkarypidis/" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">LinkedIn</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto:xaralaboskaripidis@gmail.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Create a multitenant application with Entity Framework Code First - Part 1
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Mon Nov 17 2014 23:15:00 GMT+0100">
	
		    Nov 17, 2014
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/multitenant/">multitenant</a>, <a class="category-link" href="/categories/multitenant/application-design/">application design</a>, <a class="category-link" href="/categories/multitenant/application-design/software-as-a-service/">software as a service</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>A highly increasing request we have to serve as developers, especially after Software as a Service revolution, is to provide software that is able to handle individual users in one application by separate each user’s data. This feature is called <a href="http://en.wikipedia.org/wiki/Multitenancy" target="_blank" rel="external">Multitenancy</a> and there are several ways to achieve it. In this series of posts I will try to demonstrate how we can achieve the data isolation by using some advance features of Entity Framework.<br><a id="more"></a></p>
<hr>
<h4 id="The-really-simple-model"><a href="#The-really-simple-model" class="headerlink" title="The really simple model"></a>The really simple model</h4><p>The first part includes the description of the model used across the application. Lets assume we want to manage some Messages for our application and each logged in user should be able to access and modify only his personal messages. The Message is a classic <a href="http://en.wikipedia.org/wiki/Plain_Old_CLR_Object" target="_blank" rel="external">POCO</a> class that doesn’t have any Entity Framework specific code as you can see in the snippet below.<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Message POCO</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Message</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> TenantId { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> ApplicationUser User { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    [Required]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Description { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>We follow mainly the convention over configuration approach Entity Framework provides and the only explicit configuration we have to apply in our Message class is to declare TenantId as foreign key for User property by adding the code that follows in the DbContext class we are going to use for data access.<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Entity configuration</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">DbModelBuilder modelBuilder</span>) </span>{</span><br><span class="line">    <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line"></span><br><span class="line">    modelBuilder.Entity&lt;Message&gt;()</span><br><span class="line">        .HasRequired(m =&gt; m.User)</span><br><span class="line">        .WithMany()</span><br><span class="line">        .HasForeignKey(m =&gt; m.TenantId)</span><br><span class="line">        .WillCascadeOnDelete(<span class="keyword">true</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<hr>
<h4 id="The-“manual”-approach"><a href="#The-“manual”-approach" class="headerlink" title="The “manual” approach"></a>The “manual” approach</h4><p>I will first implement an MVC Controller that includes the logic of filtering based on TenantId and assign the correct TenantId when creating a new message. The code we have to write is more or less like the snippet below:<br><figure class="codeblock codeblock--tabbed"><figcaption><span>Controller</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[Authorize]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MessagesController</span> : <span class="title">Controller</span> {</span><br><span class="line">    <span class="keyword">private</span> ApplicationDbContext db = <span class="keyword">new</span> ApplicationDbContext();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> UserId { <span class="keyword">get</span> { <span class="keyword">return</span> User.Identity.IsAuthenticated ? User.Identity.GetUserId() : <span class="keyword">string</span>.Empty; }}</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Index</span>(<span class="params"></span>) </span>{</span><br><span class="line">        <span class="comment">// Tenant specific query logic</span></span><br><span class="line">        <span class="keyword">var</span> messages = db.Messages.Include(m =&gt; m.User).Where(m =&gt; m.TenantId == UserId);</span><br><span class="line">        <span class="keyword">return</span> View(messages.ToList());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Details</span>(<span class="params"><span class="keyword">long</span>? id</span>) </span>{</span><br><span class="line">        <span class="comment">// Tenant specific query logic</span></span><br><span class="line">        Message message = db.Messages.SingleOrDefault(m =&gt; m.Id == id &amp;&amp; m.TenantId == UserId);</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> HttpNotFound();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> View(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Create</span>(<span class="params">[Bind(Include = <span class="string">"Id,Description"</span></span>)] Message message) </span>{</span><br><span class="line">        <span class="keyword">if</span> (ModelState.IsValid) {</span><br><span class="line">            <span class="comment">// Assign tenant Id explicitly</span></span><br><span class="line">            message.TenantId = UserId;</span><br><span class="line">            db.Messages.Add(message);</span><br><span class="line">            db.SaveChanges();</span><br><span class="line">            <span class="keyword">return</span> RedirectToAction(<span class="string">"Index"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> View(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Edit</span>(<span class="params"><span class="keyword">long</span>? id</span>) </span>{</span><br><span class="line">        <span class="comment">// Tenant specific query logic</span></span><br><span class="line">        Message message = db.Messages.SingleOrDefault(m =&gt; m.Id == id &amp;&amp; m.TenantId == UserId);</span><br><span class="line">        <span class="keyword">if</span> (message == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">return</span> HttpNotFound();</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> View(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Edit</span>(<span class="params">[Bind(Include = <span class="string">"Id,Description"</span></span>)] Message message) </span>{</span><br><span class="line">        <span class="keyword">if</span> (ModelState.IsValid) {</span><br><span class="line">            <span class="comment">// Assign tenant Id explicitly</span></span><br><span class="line">            message.TenantId = UserId;</span><br><span class="line">            db.Entry(message).State = EntityState.Modified;</span><br><span class="line">            db.SaveChanges();</span><br><span class="line">            <span class="keyword">return</span> RedirectToAction(<span class="string">"Index"</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> View(message);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure></p>
<p>I didn’t include all required logic and also removed the delete functionality but the problem of always remember to filter the correct data is obvious. On top of this we must assign the TenantId property explicitly as the user should not be able to do something like this. This approach is of course a valid solution but requires a lot of repetition of the same logic throughout our application something that is always error prone. On top of this the entire application has knowledge of the TenantId concept. We could solve this problem by creating a base class, something like base Repository or similar approach, and hide this detail there. This would definitely improve the design but still when the base class is not enough we have to remember to apply the filtering.</p>
<hr>
<h4 id="Entity-Framework-Interceptors"><a href="#Entity-Framework-Interceptors" class="headerlink" title="Entity Framework Interceptors"></a>Entity Framework Interceptors</h4><p><a href="http://msdn.microsoft.com/en-us/data/dn469464.aspx#BuildingBlocks" target="_blank" rel="external">Entity Framework Interceptors</a> is a very powerful feature added in version 6 of the framework and we can use them in order to hide the filtering and assign the correct TenantId in only one place. To be able to do that we must first write some infrastructure code.</p>
<hr>
<h4 id="TenantAwareAttribute-and-custom-convention"><a href="#TenantAwareAttribute-and-custom-convention" class="headerlink" title="TenantAwareAttribute and custom convention"></a>TenantAwareAttribute and custom convention</h4><p>The first step is to create an ordinary attribute class with which we can annotate our classes in order to get the Tenant functionality automatically. The code for the attribute class is shown below:</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Custom Attribute</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[AttributeUsage(AttributeTargets.Class, AllowMultiple = <span class="keyword">false</span>)]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TenantAwareAttribute</span> : <span class="title">Attribute</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> TenantAnnotation = <span class="string">"TenantAnnotation"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">const</span> <span class="keyword">string</span> TenantIdFilterParameterName = <span class="string">"TenantIdParameter"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> ColumnName { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TenantAwareAttribute</span>(<span class="params"><span class="keyword">string</span> columnName</span>) </span>{</span><br><span class="line">        ColumnName = columnName;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">GetTenantColumnName</span>(<span class="params">EdmType type</span>) </span>{</span><br><span class="line">        MetadataProperty annotation = type.MetadataProperties.SingleOrDefault(</span><br><span class="line">            p =&gt; p.Name.EndsWith(<span class="keyword">string</span>.Format(<span class="string">"customannotation:{0}"</span>, TenantAnnotation)));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> annotation == <span class="keyword">null</span> ? <span class="keyword">null</span> : (<span class="keyword">string</span>)annotation.Value;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>When using this attribute we have to declare which property of the class is the one responsible for TenantId. Moreover exposes a static helper method to get the the tenant column name based on the EdmType.</p>
<p>The next step is to use this attribute by adding a custom <a href="http://msdn.microsoft.com/en-us/data/jj819164.aspx" target="_blank" rel="external">Entity Framework convention</a> to the DbContext class we are going to use for data access in our application. To do this we have to add the code snippet below on the DbContext class.</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Add attribute to configuration</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">DbModelBuilder modelBuilder</span>) </span>{</span><br><span class="line">    <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line"></span><br><span class="line">    modelBuilder.Entity&lt;Message&gt;()</span><br><span class="line">        .HasRequired(m =&gt; m.User)</span><br><span class="line">        .WithMany()</span><br><span class="line">        .HasForeignKey(m =&gt; m.TenantId)</span><br><span class="line">        .WillCascadeOnDelete(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> conv = <span class="keyword">new</span> AttributeToTableAnnotationConvention&lt;TenantAwareAttribute, <span class="keyword">string</span>&gt;(</span><br><span class="line">                    TenantAwareAttribute.TenantAnnotation, (type, attributes) =&gt; attributes.Single().ColumnName);</span><br><span class="line"></span><br><span class="line">    modelBuilder.Conventions.Add(conv);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<hr>
<h4 id="Changes-in-Message-class"><a href="#Changes-in-Message-class" class="headerlink" title="Changes in Message class"></a>Changes in Message class</h4><p>After creating this infrastructure code the Message class can change and decorate it with the TenantAwareAttribute attribute as below:</p>
<figure class="codeblock codeblock--tabbed"><figcaption><span>Changed Message POCO</span><ul class="tabs"><li class="tab active">cs</li></ul></figcaption><div class="tabs-content"><figure class="highlight cs" style="display: block;"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[TenantAware(<span class="string">"TenantId"</span>)]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Message</span> {</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> Id { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> TenantId { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> ApplicationUser User { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">    [Required]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Description { <span class="keyword">get</span>; <span class="keyword">set</span>; }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></div></figure>
<p>As we can see here there is another important change in the class. The TenantId property now is private set which means we can’t explicitly assign it from our code base. The last issue is quite important as we are not able to assign an invalid TenantId by mistake. Furthermore we don’t have to take care of assign a TenantId at all.</p>
<hr>
<p>This was the first part of a series of three posts. It includes the problem and the infrastructure code for what is coming on the next posts. For those that can’t wait I have created a <a href="https://github.com/xabikos/EfMultitenant" target="_blank" rel="external">project in Github</a> that contains the full code in a relatively change model. In the next post I will describe how we can use the code we already created to apply filtering based on TenantId always in a transparent way for our application.</p>
<h3 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a><a href="/2014/11/18/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-2/">Part 2</a></h3><h3 id="Part-3"><a href="#Part-3" class="headerlink" title="Part 3"></a><a href="/2014/11/19/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-3/">Part 3</a></h3>
            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/code-first/">code first</a> <a class="tag tag--primary tag--small t-link" href="/tags/entity-framework/">entity framework</a> <a class="tag tag--primary tag--small t-link" href="/tags/interceptors/">interceptors</a> <a class="tag tag--primary tag--small t-link" href="/tags/multi-tenant/">multi-tenant</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/11/18/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-2/"  data-tooltip="Create a multitenant application with Entity Framework Code First - Part 2">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/11/05/user-confirmed-filter-attribute/" data-tooltip="ASP.NET User confirmed email filter attribute">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Babis Karypidis. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/11/18/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-2/"  data-tooltip="Create a multitenant application with Entity Framework Code First - Part 2">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/11/05/user-confirmed-filter-attribute/" data-tooltip="ASP.NET User confirmed email filter attribute">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        


    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <img id="about-card-picture" src="http://www.gravatar.com/avatar/7c9ee05396641133c8d505197fc17cc5?s=110"/>
        
            <h4 id="about-card-name">Babis Karypidis</h4>
        
            <h5 id="about-card-bio"><p>Hi, I am Babis Karypidis, a Greek software engineer who tries to fit other activities, except development, in his life.</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Freelance Software Engineer focusing on .NET, Azure and React.js</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Brussels, Belgium
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('https://globalazurereport.blob.core.windows.net/personalblog/web_development_top.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/scrip-rjanlllosg30d03qrddpwrs6wqf4k3v0bbo68hiifuvthyhqfefx2htcagu0.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'http://xabikostest.github.io/2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/';
                 
                    this.page.identifier = '2014/11/17/Create-a-multitenant-application-with-Entity-Framework-Code-First-Part-1/';
                                  
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'xabikos';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



</html>
